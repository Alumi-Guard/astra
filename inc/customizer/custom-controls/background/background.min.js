jQuery(window).on("load",function(){jQuery("html").addClass("background-colorpicker-ready")}),wp.customize.controlConstructor["ast-background"]=wp.customize.Control.extend({ready:function(){"use strict";this.initAstBgControl()},initAstBgControl:function(){var i=this,n=i.setting._value,e=i.container.find(".ast-color-control");(_.isUndefined(n["background-image"])||""===n["background-image"])&&(i.container.find(".background-wrapper > .background-repeat").hide(),i.container.find(".background-wrapper > .background-position").hide(),i.container.find(".background-wrapper > .background-size").hide(),i.container.find(".background-wrapper > .background-attachment").hide()),e.wpColorPicker({change:function(){jQuery("html").hasClass("background-colorpicker-ready")&&setTimeout(function(){i.saveValue("background-color",e.val())},100)},clear:function(n){jQuery(n.target).closest(".wp-picker-input-wrap").find(".wp-color-picker")[0]&&i.saveValue("background-color","")}}),i.container.on("change",".background-repeat select",function(){i.saveValue("background-repeat",jQuery(this).val())}),i.container.on("change click",".background-size input",function(){i.saveValue("background-size",jQuery(this).val())}),i.container.on("change",".background-position select",function(){i.saveValue("background-position",jQuery(this).val())}),i.container.on("change click",".background-attachment input",function(){i.saveValue("background-attachment",jQuery(this).val())}),i.container.on("click",".background-image-upload-button",function(n){var r=wp.media({multiple:!1}).open().on("select",function(){var n,e,a,t=r.state().get("selection").first(),o=t.toJSON().sizes.full.url;_.isUndefined(t.toJSON().sizes.medium)?_.isUndefined(t.toJSON().sizes.thumbnail)||(o=t.toJSON().sizes.thumbnail.url):o=t.toJSON().sizes.medium.url,n=t.toJSON().sizes.full.url,t.toJSON().id,t.toJSON().width,t.toJSON().height,""!==n&&i.container.find(".background-wrapper > .background-repeat, .background-wrapper > .background-position, .background-wrapper > .background-size, .background-wrapper > .background-attachment").show(),i.saveValue("background-image",n),e=i.container.find(".placeholder, .thumbnail"),a=i.container.find(".background-image-upload-remove-button"),e.length&&e.removeClass().addClass("thumbnail thumbnail-image").html('<img src="'+o+'" alt="" />'),a.length&&a.show()});n.preventDefault()}),i.container.on("click",".background-image-upload-remove-button",function(n){var e,a;n.preventDefault(),i.saveValue("background-image",""),e=i.container.find(".placeholder, .thumbnail"),a=i.container.find(".background-image-upload-remove-button"),i.container.find(".background-wrapper > .background-repeat").hide(),i.container.find(".background-wrapper > .background-position").hide(),i.container.find(".background-wrapper > .background-size").hide(),i.container.find(".background-wrapper > .background-attachment").hide(),i.container.find(".more-settings").attr("data-direction","down"),i.container.find(".more-settings").find(".message").html(astraCustomizerControlBackground.moreSettings),i.container.find(".more-settings").find(".icon").html("↓"),e.length&&e.removeClass().addClass("placeholder").html(astraCustomizerControlBackground.placeholder),a.length&&a.hide()}),i.container.on("click",".more-settings",function(n){i.container.find(".background-wrapper > .background-repeat").toggle(),i.container.find(".background-wrapper > .background-position").toggle(),i.container.find(".background-wrapper > .background-size").toggle(),i.container.find(".background-wrapper > .background-attachment").toggle(),"down"===$(this).attr("data-direction")?($(this).attr("data-direction","up"),$(this).find(".message").html(astraCustomizerControlBackground.lessSettings),$(this).find(".icon").html("↑")):($(this).attr("data-direction","down"),$(this).find(".message").html(astraCustomizerControlBackground.moreSettings),$(this).find(".icon").html("↓"))})},saveValue:function(n,e){var a=this,t=jQuery("#customize-control-"+a.id.replace("[","-").replace("]","")+" .background-hidden-value"),o=a.setting._value;o[n]=e,jQuery(t).attr("value",JSON.stringify(o)).trigger("change"),a.setting.set(o)}});